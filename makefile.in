NAME='snapman'
PREFIX='/usr'
# For install things in $pkgdir/etc:
DESTDIR=''
TEMPDIR := $(shell mktemp -u --suffix .$(NAME))
DOCS = AUTHORS BUGS ChangeLog CREDITS FAQ INSTALL NEWS README README.es THANKS TODO USAGE USAGE.es


manpages:
	pandoc man/en/$(NAME).1.md -s -t man | gzip -c > $(NAME).1.gz
	pandoc man/en/$(NAME).5.md -s -t man | gzip -c > $(NAME).5.gz

docs: manpages doc

install: install_doc
	install -Dm 755 src/$(NAME).py $(DESTDIR)/$(PREFIX)/bin/$(NAME)
	install -Dm 644 src/$(NAME).ini $(DESTDIR)/etc/$(NAME).ini
	install -Dm 644 src/$(NAME).service $(DESTDIR)/$(PREFIX)/lib/systemd/system/$(NAME).service
	install -Dm 644 LICENSE $(DESTDIR)/$(PREFIX)/share/licenses/$(NAME)/COPYING
	install -Dm 644 $(NAME).1.gz $(DESTDIR)/$(PREFIX)/share/man/man1/$(NAME).1.gz
	install -Dm 644 $(NAME).5.gz $(DESTDIR)/$(PREFIX)/share/man/man5/$(NAME).5.gz

uninstall:
	rm -f $(PREFIX)/bin/$(NAME)
	rm -f /etc/$(NAME).ini
	rm -f $(PREFIX)/lib/systemd/system/$(NAME).service
	rm -rf $(PREFIX)/share/licenses/$(NAME)/
	rm -rf $(PREFIX)/share/doc/$(NAME)/
	rm -f $(PREFIX)/share/man/man1/$(NAME).1.gz
	rm -f $(PREFIX)/share/man/man5/$(NAME).5.gz

clean:
	rm -rf *.xz *.md *.gz /tmp/tmp.*.$(NAME)

pkg:
	mkdir $(TEMPDIR)
	tar cf $(TEMPDIR)/$(NAME).tar ../$(NAME)
	cp packages/* ChangeLog $(TEMPDIR)/
	cd $(TEMPDIR); makepkg
	cp $(TEMPDIR)/$(NAME)-*.pkg.tar.xz .
	@echo Package done!
	@echo You can install it as root with:
	@echo pacman -U $(NAME)-*.pkg.tar.xz
